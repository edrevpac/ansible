---

- hosts: jenkins

  become: true

  environment:
    JAVA_HOME: /usr/lib/jvm/default-java

  tasks:

  - name: Import Jenkins APT key
    apt_key: 
      url: https://pkg.jenkins.io/debian/jenkins.io.key
      state: present
    register: command_result
    retries: 3
    delay: 3
    until: command_result | success
      
  - name: Add Jenkins package APT repository
    apt_repository:
      repo: deb https://pkg.jenkins.io/debian binary/
      state: present
    register: command_result
    retries: 3
    delay: 3
    until: command_result | success
      
  - name: Install Jenkins 2.85
    apt:
      name: jenkins
      update_cache: yes
    register: command_result
    retries: 3
    delay: 3
    until: command_result | success